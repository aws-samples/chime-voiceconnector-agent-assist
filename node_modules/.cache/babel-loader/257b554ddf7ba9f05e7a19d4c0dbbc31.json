{"ast":null,"code":"/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport * as React from 'react';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AmplifyTheme from '../../Amplify-UI/Amplify-UI-Theme'; // import auth0 from 'auth0-js';\n\nimport { auth0SignInButton } from '@aws-amplify/ui';\nimport { SignInButton, SignInButtonIcon, SignInButtonContent } from '../../Amplify-UI/Amplify-UI-Components-React';\nimport Constants from '../common/constants';\nvar logger = new Logger('withAuth0');\nexport default function withAuth0(Comp, options) {\n  return (\n    /** @class */\n    function (_super) {\n      __extends(class_1, _super);\n\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this._auth0 = null;\n        _this.initialize = _this.initialize.bind(_this);\n        _this.signIn = _this.signIn.bind(_this);\n        _this.signOut = _this.signOut.bind(_this);\n        return _this;\n      }\n\n      class_1.prototype.componentDidMount = function () {\n        if (!window.auth0) {\n          this.createScript();\n        } else {\n          this.initialize();\n        }\n      };\n\n      class_1.prototype.createScript = function () {\n        var script = document.createElement('script');\n        script.src = 'https://cdn.auth0.com/js/auth0/9.8.1/auth0.min.js';\n        script.async = true;\n        script.onload = this.initialize;\n        document.body.appendChild(script);\n      };\n\n      class_1.prototype.initialize = function () {\n        var _this = this; // @ts-ignore\n\n\n        var _a = Auth.configure().oauth,\n            oauth = _a === void 0 ? {} : _a; // @ts-ignore\n\n        var config = this.props.auth0 || options || oauth.auth0;\n        var _b = this.props,\n            onError = _b.onError,\n            onStateChange = _b.onStateChange,\n            authState = _b.authState;\n\n        if (!config) {\n          logger.debug('Auth0 is not configured');\n          return;\n        }\n\n        logger.debug('withAuth0 configuration', config);\n\n        if (!this._auth0) {\n          this._auth0 = new window['auth0'].WebAuth(config);\n          window.auth0_client = this._auth0;\n        }\n\n        if (authState !== 'signedIn') {\n          this._auth0.parseHash(function (err, authResult) {\n            if (err || !authResult) {\n              logger.debug('Failed to parse the url for Auth0', err);\n              return;\n            }\n\n            var payload = {\n              provider: Constants.AUTH0,\n              opts: {\n                returnTo: config.returnTo,\n                clientID: config.clientID,\n                federated: config.federated\n              }\n            };\n\n            try {\n              localStorage.setItem(Constants.AUTH_SOURCE_KEY, JSON.stringify(payload));\n            } catch (e) {\n              logger.debug('Failed to cache auth source into localStorage', e);\n            }\n\n            _this._auth0.client.userInfo(authResult.accessToken, function (err, user) {\n              var username = undefined;\n              var email = undefined;\n\n              if (err) {\n                logger.debug('Failed to get the user info', err);\n              } else {\n                username = user.name;\n                email = user.email;\n              }\n\n              Auth.federatedSignIn(config.domain, {\n                token: authResult.idToken,\n                expires_at: authResult.expiresIn * 1000 + new Date().getTime()\n              }, {\n                name: username,\n                email: email\n              }).then(function () {\n                if (onStateChange) {\n                  Auth.currentAuthenticatedUser().then(function (user) {\n                    onStateChange('signedIn', user);\n                  });\n                }\n              }).catch(function (e) {\n                logger.debug('Failed to get the aws credentials', e);\n                if (onError) onError(e);\n              });\n            });\n          });\n        }\n      };\n\n      class_1.prototype.signIn = function () {\n        return __awaiter(this, void 0, void 0, function () {\n          return __generator(this, function (_a) {\n            if (this._auth0) this._auth0.authorize();else {\n              throw new Error('the auth0 client is not configured');\n            }\n            return [2\n            /*return*/\n            ];\n          });\n        });\n      };\n\n      class_1.prototype.signOut = function (opts) {\n        if (opts === void 0) {\n          opts = {};\n        }\n\n        var auth0 = window.auth0_client; // @ts-ignore\n\n        var returnTo = opts.returnTo,\n            clientID = opts.clientID,\n            federated = opts.federated;\n\n        if (!auth0) {\n          logger.debug('auth0 sdk undefined');\n          return Promise.resolve();\n        }\n\n        auth0.logout({\n          returnTo: returnTo,\n          clientID: clientID,\n          federated: federated\n        });\n      };\n\n      class_1.prototype.render = function () {\n        return React.createElement(Comp, __assign({}, this.props, {\n          auth0: this._auth0,\n          auth0SignIn: this.signIn,\n          auth0SignOut: this.signOut\n        }));\n      };\n\n      return class_1;\n    }(React.Component)\n  );\n}\n\nvar Button = function Button(props) {\n  return React.createElement(SignInButton, {\n    id: auth0SignInButton,\n    onClick: props.auth0SignIn,\n    theme: props.theme || AmplifyTheme,\n    variant: 'auth0SignInButton'\n  }, React.createElement(SignInButtonIcon, {\n    theme: props.theme || AmplifyTheme\n  }, React.createElement(\"svg\", {\n    id: \"artwork\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 193.7 216.6\"\n  }, React.createElement(\"path\", {\n    id: \"NEW\",\n    className: \"st0\",\n    d: \"M189,66.9L167.2,0H96.8l21.8,66.9H189z M96.8,0H26.5L4.8,66.9h70.4L96.8,0z M4.8,66.9L4.8,66.9\\tc-13,39.9,1.2,83.6,35.2,108.3l21.7-66.9L4.8,66.9z M189,66.9L189,66.9l-57,41.4l21.7,66.9l0,0C187.7,150.6,201.9,106.8,189,66.9\\tL189,66.9z M39.9,175.2L39.9,175.2l56.9,41.4l56.9-41.4l-56.9-41.4L39.9,175.2z\"\n  }))), React.createElement(SignInButtonContent, {\n    theme: props.theme || AmplifyTheme\n  }, props.label || 'Sign In with Auth0'));\n};\n\nexport var Auth0Button = withAuth0(Button);","map":{"version":3,"sources":["../../../src/Auth/Provider/withAuth0.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport * as React from 'react';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AmplifyTheme from '../../Amplify-UI/Amplify-UI-Theme';\n// import auth0 from 'auth0-js';\nimport { auth0SignInButton } from '@aws-amplify/ui';\nimport { SignInButton, SignInButtonIcon, SignInButtonContent, } from '../../Amplify-UI/Amplify-UI-Components-React';\nimport Constants from '../common/constants';\nvar logger = new Logger('withAuth0');\nexport default function withAuth0(Comp, options) {\n    return /** @class */ (function (_super) {\n        __extends(class_1, _super);\n        function class_1(props) {\n            var _this = _super.call(this, props) || this;\n            _this._auth0 = null;\n            _this.initialize = _this.initialize.bind(_this);\n            _this.signIn = _this.signIn.bind(_this);\n            _this.signOut = _this.signOut.bind(_this);\n            return _this;\n        }\n        class_1.prototype.componentDidMount = function () {\n            if (!window.auth0) {\n                this.createScript();\n            }\n            else {\n                this.initialize();\n            }\n        };\n        class_1.prototype.createScript = function () {\n            var script = document.createElement('script');\n            script.src = 'https://cdn.auth0.com/js/auth0/9.8.1/auth0.min.js';\n            script.async = true;\n            script.onload = this.initialize;\n            document.body.appendChild(script);\n        };\n        class_1.prototype.initialize = function () {\n            var _this = this;\n            // @ts-ignore\n            var _a = Auth.configure().oauth, oauth = _a === void 0 ? {} : _a;\n            // @ts-ignore\n            var config = this.props.auth0 || options || oauth.auth0;\n            var _b = this.props, onError = _b.onError, onStateChange = _b.onStateChange, authState = _b.authState;\n            if (!config) {\n                logger.debug('Auth0 is not configured');\n                return;\n            }\n            logger.debug('withAuth0 configuration', config);\n            if (!this._auth0) {\n                this._auth0 = new window['auth0'].WebAuth(config);\n                window.auth0_client = this._auth0;\n            }\n            if (authState !== 'signedIn') {\n                this._auth0.parseHash(function (err, authResult) {\n                    if (err || !authResult) {\n                        logger.debug('Failed to parse the url for Auth0', err);\n                        return;\n                    }\n                    var payload = {\n                        provider: Constants.AUTH0,\n                        opts: {\n                            returnTo: config.returnTo,\n                            clientID: config.clientID,\n                            federated: config.federated,\n                        },\n                    };\n                    try {\n                        localStorage.setItem(Constants.AUTH_SOURCE_KEY, JSON.stringify(payload));\n                    }\n                    catch (e) {\n                        logger.debug('Failed to cache auth source into localStorage', e);\n                    }\n                    _this._auth0.client.userInfo(authResult.accessToken, function (err, user) {\n                        var username = undefined;\n                        var email = undefined;\n                        if (err) {\n                            logger.debug('Failed to get the user info', err);\n                        }\n                        else {\n                            username = user.name;\n                            email = user.email;\n                        }\n                        Auth.federatedSignIn(config.domain, {\n                            token: authResult.idToken,\n                            expires_at: authResult.expiresIn * 1000 + new Date().getTime(),\n                        }, { name: username, email: email })\n                            .then(function () {\n                            if (onStateChange) {\n                                Auth.currentAuthenticatedUser().then(function (user) {\n                                    onStateChange('signedIn', user);\n                                });\n                            }\n                        })\n                            .catch(function (e) {\n                            logger.debug('Failed to get the aws credentials', e);\n                            if (onError)\n                                onError(e);\n                        });\n                    });\n                });\n            }\n        };\n        class_1.prototype.signIn = function () {\n            return __awaiter(this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    if (this._auth0)\n                        this._auth0.authorize();\n                    else {\n                        throw new Error('the auth0 client is not configured');\n                    }\n                    return [2 /*return*/];\n                });\n            });\n        };\n        class_1.prototype.signOut = function (opts) {\n            if (opts === void 0) { opts = {}; }\n            var auth0 = window.auth0_client;\n            // @ts-ignore\n            var returnTo = opts.returnTo, clientID = opts.clientID, federated = opts.federated;\n            if (!auth0) {\n                logger.debug('auth0 sdk undefined');\n                return Promise.resolve();\n            }\n            auth0.logout({\n                returnTo: returnTo,\n                clientID: clientID,\n                federated: federated,\n            });\n        };\n        class_1.prototype.render = function () {\n            return (React.createElement(Comp, __assign({}, this.props, { auth0: this._auth0, auth0SignIn: this.signIn, auth0SignOut: this.signOut })));\n        };\n        return class_1;\n    }(React.Component));\n}\nvar Button = function (props) { return (React.createElement(SignInButton, { id: auth0SignInButton, onClick: props.auth0SignIn, theme: props.theme || AmplifyTheme, variant: 'auth0SignInButton' },\n    React.createElement(SignInButtonIcon, { theme: props.theme || AmplifyTheme },\n        React.createElement(\"svg\", { id: \"artwork\", xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 193.7 216.6\" },\n            React.createElement(\"path\", { id: \"NEW\", className: \"st0\", d: \"M189,66.9L167.2,0H96.8l21.8,66.9H189z M96.8,0H26.5L4.8,66.9h70.4L96.8,0z M4.8,66.9L4.8,66.9\\tc-13,39.9,1.2,83.6,35.2,108.3l21.7-66.9L4.8,66.9z M189,66.9L189,66.9l-57,41.4l21.7,66.9l0,0C187.7,150.6,201.9,106.8,189,66.9\\tL189,66.9z M39.9,175.2L39.9,175.2l56.9,41.4l56.9-41.4l-56.9-41.4L39.9,175.2z\" }))),\n    React.createElement(SignInButtonContent, { theme: props.theme || AmplifyTheme }, props.label || 'Sign In with Auth0'))); };\nexport var Auth0Button = withAuth0(Button);\n//# sourceMappingURL=withAuth0.js.map"]},"metadata":{},"sourceType":"module"}