{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as React from 'react';\nimport { Component } from 'react';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Storage from '@aws-amplify/storage';\nimport AmplifyTheme from '../AmplifyTheme';\nimport { transparent1X1 } from '../AmplifyUI';\nimport PhotoPicker from '../Widget/PhotoPicker';\nimport { calcKey } from './Common';\nvar logger = new Logger('Storage.S3Image');\n\nvar S3Image =\n/** @class */\nfunction (_super) {\n  __extends(S3Image, _super);\n\n  function S3Image(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._isMounted = false;\n    _this.handleOnLoad = _this.handleOnLoad.bind(_this);\n    _this.handleOnError = _this.handleOnError.bind(_this);\n    _this.handlePick = _this.handlePick.bind(_this);\n    _this.handleClick = _this.handleClick.bind(_this);\n    var initSrc = _this.props.src || transparent1X1;\n    _this.state = {\n      src: initSrc\n    };\n    return _this;\n  }\n\n  S3Image.prototype.getImageSource = function (key, level, track, identityId) {\n    var _this = this;\n\n    if (!Storage || typeof Storage.get !== 'function') {\n      throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n    }\n\n    Storage.get(key, {\n      level: level ? level : 'public',\n      track: track,\n      identityId: identityId\n    }).then(function (url) {\n      if (_this._isMounted) {\n        _this.setState({\n          src: url\n        });\n      }\n    }).catch(function (err) {\n      return logger.debug(err);\n    });\n  };\n\n  S3Image.prototype.load = function () {\n    var _a = this.props,\n        imgKey = _a.imgKey,\n        path = _a.path,\n        body = _a.body,\n        contentType = _a.contentType,\n        level = _a.level,\n        track = _a.track,\n        identityId = _a.identityId;\n\n    if (!imgKey && !path) {\n      logger.debug('empty imgKey and path');\n      return;\n    }\n\n    var that = this;\n    var key = imgKey || path;\n    logger.debug('loading ' + key + '...');\n\n    if (body) {\n      var type = contentType || 'binary/octet-stream';\n\n      if (!Storage || typeof Storage.put !== 'function') {\n        throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n      }\n\n      var ret = Storage.put(key, body, {\n        contentType: type,\n        level: level ? level : 'public',\n        track: track\n      });\n      ret.then(function (data) {\n        logger.debug(data);\n        that.getImageSource(key, level, track, identityId);\n      }).catch(function (err) {\n        return logger.debug(err);\n      });\n    } else {\n      that.getImageSource(key, level, track, identityId);\n    }\n  };\n\n  S3Image.prototype.handleOnLoad = function (evt) {\n    var onLoad = this.props.onLoad;\n\n    if (onLoad) {\n      onLoad(this.state.src);\n    }\n  };\n\n  S3Image.prototype.handleOnError = function (evt) {\n    var onError = this.props.onError;\n\n    if (onError) {\n      onError(this.state.src);\n    }\n  };\n\n  S3Image.prototype.handlePick = function (data) {\n    var that = this;\n    var _a = this.props,\n        imgKey = _a.imgKey,\n        level = _a.level,\n        fileToKey = _a.fileToKey,\n        track = _a.track,\n        identityId = _a.identityId,\n        _b = _a.path,\n        path = _b === void 0 ? '' : _b,\n        onUploadSuccess = _a.onUploadSuccess;\n    var file = data.file,\n        type = data.type;\n    var key = imgKey || path + calcKey(data, fileToKey);\n\n    if (!Storage || typeof Storage.put !== 'function') {\n      throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n    }\n\n    Storage.put(key, file, {\n      level: level ? level : 'public',\n      contentType: type,\n      track: track\n    }).then(function (data) {\n      logger.debug('handle pick data', data);\n      that.getImageSource(key, level, track, identityId);\n      if (onUploadSuccess) onUploadSuccess();\n    }).catch(function (err) {\n      return logger.debug('handle pick error', err);\n    });\n  };\n\n  S3Image.prototype.handleClick = function (evt) {\n    var onClick = this.props.onClick;\n\n    if (onClick) {\n      onClick(evt);\n    }\n  };\n\n  S3Image.prototype.componentDidMount = function () {\n    this._isMounted = true;\n    this.load();\n  };\n\n  S3Image.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n  };\n\n  S3Image.prototype.componentDidUpdate = function (prevProps) {\n    var update = prevProps.path !== this.props.path || prevProps.imgKey !== this.props.imgKey || prevProps.body !== this.props.body || prevProps.level !== this.props.level;\n\n    if (update) {\n      this.load();\n    }\n  };\n\n  S3Image.prototype.imageEl = function (src, theme) {\n    if (!src) {\n      return null;\n    }\n\n    var _a = this.props,\n        className = _a.className,\n        selected = _a.selected;\n    var containerStyle = {\n      position: 'relative'\n    };\n    return React.createElement(\"div\", {\n      style: containerStyle,\n      onClick: this.handleClick\n    }, React.createElement(\"img\", {\n      className: className,\n      style: theme.photoImg,\n      src: src,\n      onLoad: this.handleOnLoad,\n      onError: this.handleOnError\n    }), React.createElement(\"div\", {\n      style: selected ? theme.overlaySelected : theme.overlay\n    }));\n  };\n\n  S3Image.prototype.render = function () {\n    var _a = this.props,\n        hidden = _a.hidden,\n        style = _a.style,\n        picker = _a.picker,\n        translate = _a.translate,\n        imgKey = _a.imgKey;\n    var src = this.state.src;\n\n    if (translate) {\n      src = typeof translate === 'string' ? translate : translate({\n        type: 'image',\n        key: imgKey,\n        content: src\n      });\n    }\n\n    if (!src && !picker) {\n      return null;\n    }\n\n    var theme = this.props.theme || AmplifyTheme;\n    var photoStyle = hidden ? AmplifyTheme.hidden : Object.assign({}, theme.photo, style);\n    return React.createElement(\"div\", {\n      style: photoStyle\n    }, photoStyle ? this.imageEl(src, theme) : null, picker ? React.createElement(\"div\", null, React.createElement(PhotoPicker, {\n      key: \"picker\",\n      onPick: this.handlePick,\n      theme: theme\n    })) : null);\n  };\n\n  return S3Image;\n}(Component);\n\nexport default S3Image;","map":{"version":3,"sources":["../../src/Storage/S3Image.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport * as React from 'react';\nimport { Component } from 'react';\nimport { ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Storage from '@aws-amplify/storage';\nimport AmplifyTheme from '../AmplifyTheme';\nimport { transparent1X1 } from '../AmplifyUI';\nimport PhotoPicker from '../Widget/PhotoPicker';\nimport { calcKey } from './Common';\nvar logger = new Logger('Storage.S3Image');\nvar S3Image = /** @class */ (function (_super) {\n    __extends(S3Image, _super);\n    function S3Image(props) {\n        var _this = _super.call(this, props) || this;\n        _this._isMounted = false;\n        _this.handleOnLoad = _this.handleOnLoad.bind(_this);\n        _this.handleOnError = _this.handleOnError.bind(_this);\n        _this.handlePick = _this.handlePick.bind(_this);\n        _this.handleClick = _this.handleClick.bind(_this);\n        var initSrc = _this.props.src || transparent1X1;\n        _this.state = { src: initSrc };\n        return _this;\n    }\n    S3Image.prototype.getImageSource = function (key, level, track, identityId) {\n        var _this = this;\n        if (!Storage || typeof Storage.get !== 'function') {\n            throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n        }\n        Storage.get(key, { level: level ? level : 'public', track: track, identityId: identityId })\n            .then(function (url) {\n            if (_this._isMounted) {\n                _this.setState({\n                    src: url,\n                });\n            }\n        })\n            .catch(function (err) { return logger.debug(err); });\n    };\n    S3Image.prototype.load = function () {\n        var _a = this.props, imgKey = _a.imgKey, path = _a.path, body = _a.body, contentType = _a.contentType, level = _a.level, track = _a.track, identityId = _a.identityId;\n        if (!imgKey && !path) {\n            logger.debug('empty imgKey and path');\n            return;\n        }\n        var that = this;\n        var key = imgKey || path;\n        logger.debug('loading ' + key + '...');\n        if (body) {\n            var type = contentType || 'binary/octet-stream';\n            if (!Storage || typeof Storage.put !== 'function') {\n                throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n            }\n            var ret = Storage.put(key, body, {\n                contentType: type,\n                level: level ? level : 'public',\n                track: track,\n            });\n            ret\n                .then(function (data) {\n                logger.debug(data);\n                that.getImageSource(key, level, track, identityId);\n            })\n                .catch(function (err) { return logger.debug(err); });\n        }\n        else {\n            that.getImageSource(key, level, track, identityId);\n        }\n    };\n    S3Image.prototype.handleOnLoad = function (evt) {\n        var onLoad = this.props.onLoad;\n        if (onLoad) {\n            onLoad(this.state.src);\n        }\n    };\n    S3Image.prototype.handleOnError = function (evt) {\n        var onError = this.props.onError;\n        if (onError) {\n            onError(this.state.src);\n        }\n    };\n    S3Image.prototype.handlePick = function (data) {\n        var that = this;\n        var _a = this.props, imgKey = _a.imgKey, level = _a.level, fileToKey = _a.fileToKey, track = _a.track, identityId = _a.identityId, _b = _a.path, path = _b === void 0 ? '' : _b, onUploadSuccess = _a.onUploadSuccess;\n        var file = data.file, type = data.type;\n        var key = imgKey || path + calcKey(data, fileToKey);\n        if (!Storage || typeof Storage.put !== 'function') {\n            throw new Error('No Storage module found, please ensure @aws-amplify/storage is imported');\n        }\n        Storage.put(key, file, {\n            level: level ? level : 'public',\n            contentType: type,\n            track: track,\n        })\n            .then(function (data) {\n            logger.debug('handle pick data', data);\n            that.getImageSource(key, level, track, identityId);\n            if (onUploadSuccess)\n                onUploadSuccess();\n        })\n            .catch(function (err) { return logger.debug('handle pick error', err); });\n    };\n    S3Image.prototype.handleClick = function (evt) {\n        var onClick = this.props.onClick;\n        if (onClick) {\n            onClick(evt);\n        }\n    };\n    S3Image.prototype.componentDidMount = function () {\n        this._isMounted = true;\n        this.load();\n    };\n    S3Image.prototype.componentWillUnmount = function () {\n        this._isMounted = false;\n    };\n    S3Image.prototype.componentDidUpdate = function (prevProps) {\n        var update = prevProps.path !== this.props.path ||\n            prevProps.imgKey !== this.props.imgKey ||\n            prevProps.body !== this.props.body ||\n            prevProps.level !== this.props.level;\n        if (update) {\n            this.load();\n        }\n    };\n    S3Image.prototype.imageEl = function (src, theme) {\n        if (!src) {\n            return null;\n        }\n        var _a = this.props, className = _a.className, selected = _a.selected;\n        var containerStyle = { position: 'relative' };\n        return (React.createElement(\"div\", { style: containerStyle, onClick: this.handleClick },\n            React.createElement(\"img\", { className: className, style: theme.photoImg, src: src, onLoad: this.handleOnLoad, onError: this.handleOnError }),\n            React.createElement(\"div\", { style: selected ? theme.overlaySelected : theme.overlay })));\n    };\n    S3Image.prototype.render = function () {\n        var _a = this.props, hidden = _a.hidden, style = _a.style, picker = _a.picker, translate = _a.translate, imgKey = _a.imgKey;\n        var src = this.state.src;\n        if (translate) {\n            src =\n                typeof translate === 'string'\n                    ? translate\n                    : translate({\n                        type: 'image',\n                        key: imgKey,\n                        content: src,\n                    });\n        }\n        if (!src && !picker) {\n            return null;\n        }\n        var theme = this.props.theme || AmplifyTheme;\n        var photoStyle = hidden\n            ? AmplifyTheme.hidden\n            : Object.assign({}, theme.photo, style);\n        return (React.createElement(\"div\", { style: photoStyle },\n            photoStyle ? this.imageEl(src, theme) : null,\n            picker ? (React.createElement(\"div\", null,\n                React.createElement(PhotoPicker, { key: \"picker\", onPick: this.handlePick, theme: theme }))) : null));\n    };\n    return S3Image;\n}(Component));\nexport default S3Image;\n//# sourceMappingURL=S3Image.js.map"]},"metadata":{},"sourceType":"module"}