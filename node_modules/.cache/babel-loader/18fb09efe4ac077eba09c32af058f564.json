{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as React from 'react';\nimport { I18n, JS, ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AuthPiece from './AuthPiece';\nimport { FormSection, SectionHeader, SectionBody, SectionFooter, Input, Button, Link, SectionFooterPrimaryContent, SectionFooterSecondaryContent } from '../Amplify-UI/Amplify-UI-Components-React';\nimport { auth } from '../Amplify-UI/data-test-attributes';\nvar logger = new Logger('RequireNewPassword');\n\nvar RequireNewPassword =\n/** @class */\nfunction (_super) {\n  __extends(RequireNewPassword, _super);\n\n  function RequireNewPassword(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._validAuthStates = ['requireNewPassword'];\n    _this.change = _this.change.bind(_this);\n    _this.checkContact = _this.checkContact.bind(_this);\n    return _this;\n  }\n\n  RequireNewPassword.prototype.checkContact = function (user) {\n    var _this = this;\n\n    if (!Auth || typeof Auth.verifiedContact !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    Auth.verifiedContact(user).then(function (data) {\n      if (!JS.isEmpty(data.verified)) {\n        _this.changeState('signedIn', user);\n      } else {\n        user = Object.assign(user, data);\n\n        _this.changeState('verifyContact', user);\n      }\n    });\n  };\n\n  RequireNewPassword.prototype.change = function () {\n    var _this = this;\n\n    var user = this.props.authData;\n    var password = this.inputs.password;\n    var requiredAttributes = user.challengeParam.requiredAttributes;\n    var attrs = objectWithProperties(this.inputs, requiredAttributes);\n\n    if (!Auth || typeof Auth.completeNewPassword !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    Auth.completeNewPassword(user, password, attrs).then(function (user) {\n      logger.debug('complete new password', user);\n\n      if (user.challengeName === 'SMS_MFA') {\n        _this.changeState('confirmSignIn', user);\n      } else if (user.challengeName === 'MFA_SETUP') {\n        logger.debug('TOTP setup', user.challengeParam);\n\n        _this.changeState('TOTPSetup', user);\n      } else {\n        _this.checkContact(user);\n      }\n    }).catch(function (err) {\n      return _this.error(err);\n    });\n  };\n\n  RequireNewPassword.prototype.showComponent = function (theme) {\n    var _this = this;\n\n    var hide = this.props.hide;\n\n    if (hide && hide.includes(RequireNewPassword)) {\n      return null;\n    }\n\n    var user = this.props.authData;\n    var requiredAttributes = user.challengeParam.requiredAttributes;\n    return React.createElement(FormSection, {\n      theme: theme,\n      \"data-test\": auth.requireNewPassword.section\n    }, React.createElement(SectionHeader, {\n      theme: theme,\n      \"data-test\": auth.requireNewPassword.headerSection\n    }, I18n.get('Change Password')), React.createElement(SectionBody, {\n      theme: theme,\n      \"data-test\": auth.requireNewPassword.bodySection\n    }, React.createElement(Input, {\n      autoFocus: true,\n      placeholder: I18n.get('New Password'),\n      theme: theme,\n      key: \"password\",\n      name: \"password\",\n      type: \"password\",\n      onChange: this.handleInputChange,\n      \"data-test\": auth.requireNewPassword.newPasswordInput\n    }), requiredAttributes.map(function (attribute) {\n      return React.createElement(Input, {\n        placeholder: I18n.get(convertToPlaceholder(attribute)),\n        theme: theme,\n        key: attribute,\n        name: attribute,\n        type: \"text\",\n        onChange: _this.handleInputChange\n      });\n    })), React.createElement(SectionFooter, {\n      theme: theme\n    }, React.createElement(SectionFooterPrimaryContent, {\n      theme: theme\n    }, React.createElement(Button, {\n      theme: theme,\n      onClick: this.change\n    }, I18n.get('Change'))), React.createElement(SectionFooterSecondaryContent, {\n      theme: theme\n    }, React.createElement(Link, {\n      theme: theme,\n      onClick: function onClick() {\n        return _this.changeState('signIn');\n      },\n      \"data-test\": auth.requireNewPassword.backToSignInLink\n    }, I18n.get('Back to Sign In')))));\n  };\n\n  return RequireNewPassword;\n}(AuthPiece);\n\nexport default RequireNewPassword;\n\nfunction convertToPlaceholder(str) {\n  return str.split('_').map(function (part) {\n    return part.charAt(0).toUpperCase() + part.substr(1).toLowerCase();\n  }).join(' ');\n}\n\nfunction objectWithProperties(obj, keys) {\n  var target = {};\n\n  for (var key in obj) {\n    if (keys.indexOf(key) === -1) {\n      continue;\n    }\n\n    if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n      continue;\n    }\n\n    target[key] = obj[key];\n  }\n\n  return target;\n}","map":{"version":3,"sources":["../../src/Auth/RequireNewPassword.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport * as React from 'react';\nimport { I18n, JS, ConsoleLogger as Logger } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AuthPiece from './AuthPiece';\nimport { FormSection, SectionHeader, SectionBody, SectionFooter, Input, Button, Link, SectionFooterPrimaryContent, SectionFooterSecondaryContent, } from '../Amplify-UI/Amplify-UI-Components-React';\nimport { auth } from '../Amplify-UI/data-test-attributes';\nvar logger = new Logger('RequireNewPassword');\nvar RequireNewPassword = /** @class */ (function (_super) {\n    __extends(RequireNewPassword, _super);\n    function RequireNewPassword(props) {\n        var _this = _super.call(this, props) || this;\n        _this._validAuthStates = ['requireNewPassword'];\n        _this.change = _this.change.bind(_this);\n        _this.checkContact = _this.checkContact.bind(_this);\n        return _this;\n    }\n    RequireNewPassword.prototype.checkContact = function (user) {\n        var _this = this;\n        if (!Auth || typeof Auth.verifiedContact !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n        }\n        Auth.verifiedContact(user).then(function (data) {\n            if (!JS.isEmpty(data.verified)) {\n                _this.changeState('signedIn', user);\n            }\n            else {\n                user = Object.assign(user, data);\n                _this.changeState('verifyContact', user);\n            }\n        });\n    };\n    RequireNewPassword.prototype.change = function () {\n        var _this = this;\n        var user = this.props.authData;\n        var password = this.inputs.password;\n        var requiredAttributes = user.challengeParam.requiredAttributes;\n        var attrs = objectWithProperties(this.inputs, requiredAttributes);\n        if (!Auth || typeof Auth.completeNewPassword !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n        }\n        Auth.completeNewPassword(user, password, attrs)\n            .then(function (user) {\n            logger.debug('complete new password', user);\n            if (user.challengeName === 'SMS_MFA') {\n                _this.changeState('confirmSignIn', user);\n            }\n            else if (user.challengeName === 'MFA_SETUP') {\n                logger.debug('TOTP setup', user.challengeParam);\n                _this.changeState('TOTPSetup', user);\n            }\n            else {\n                _this.checkContact(user);\n            }\n        })\n            .catch(function (err) { return _this.error(err); });\n    };\n    RequireNewPassword.prototype.showComponent = function (theme) {\n        var _this = this;\n        var hide = this.props.hide;\n        if (hide && hide.includes(RequireNewPassword)) {\n            return null;\n        }\n        var user = this.props.authData;\n        var requiredAttributes = user.challengeParam.requiredAttributes;\n        return (React.createElement(FormSection, { theme: theme, \"data-test\": auth.requireNewPassword.section },\n            React.createElement(SectionHeader, { theme: theme, \"data-test\": auth.requireNewPassword.headerSection }, I18n.get('Change Password')),\n            React.createElement(SectionBody, { theme: theme, \"data-test\": auth.requireNewPassword.bodySection },\n                React.createElement(Input, { autoFocus: true, placeholder: I18n.get('New Password'), theme: theme, key: \"password\", name: \"password\", type: \"password\", onChange: this.handleInputChange, \"data-test\": auth.requireNewPassword.newPasswordInput }),\n                requiredAttributes.map(function (attribute) { return (React.createElement(Input, { placeholder: I18n.get(convertToPlaceholder(attribute)), theme: theme, key: attribute, name: attribute, type: \"text\", onChange: _this.handleInputChange })); })),\n            React.createElement(SectionFooter, { theme: theme },\n                React.createElement(SectionFooterPrimaryContent, { theme: theme },\n                    React.createElement(Button, { theme: theme, onClick: this.change }, I18n.get('Change'))),\n                React.createElement(SectionFooterSecondaryContent, { theme: theme },\n                    React.createElement(Link, { theme: theme, onClick: function () { return _this.changeState('signIn'); }, \"data-test\": auth.requireNewPassword.backToSignInLink }, I18n.get('Back to Sign In'))))));\n    };\n    return RequireNewPassword;\n}(AuthPiece));\nexport default RequireNewPassword;\nfunction convertToPlaceholder(str) {\n    return str\n        .split('_')\n        .map(function (part) { return part.charAt(0).toUpperCase() + part.substr(1).toLowerCase(); })\n        .join(' ');\n}\nfunction objectWithProperties(obj, keys) {\n    var target = {};\n    for (var key in obj) {\n        if (keys.indexOf(key) === -1) {\n            continue;\n        }\n        if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n            continue;\n        }\n        target[key] = obj[key];\n    }\n    return target;\n}\n//# sourceMappingURL=RequireNewPassword.js.map"]},"metadata":{},"sourceType":"module"}