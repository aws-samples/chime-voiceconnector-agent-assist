{"ast":null,"code":"/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as React from 'react';\nimport { I18n, ConsoleLogger as Logger, Hub } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AuthPiece from './AuthPiece';\nimport { NavButton } from '../Amplify-UI/Amplify-UI-Components-React';\nimport AmplifyTheme from '../Amplify-UI/Amplify-UI-Theme';\nimport Constants from './common/constants';\nimport { auth } from '../Amplify-UI/data-test-attributes';\nvar logger = new Logger('SignOut');\n\nvar SignOut =\n/** @class */\nfunction (_super) {\n  __extends(SignOut, _super);\n\n  function SignOut(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.signOut = _this.signOut.bind(_this);\n    _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n    Hub.listen('auth', _this.onHubCapsule);\n    _this.state = {};\n    return _this;\n  }\n\n  SignOut.prototype.componentDidMount = function () {\n    this._isMounted = true;\n    this.findState();\n  };\n\n  SignOut.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n  };\n\n  SignOut.prototype.findState = function () {\n    var _this = this;\n\n    if (!this.props.authState && !this.props.authData) {\n      Auth.currentAuthenticatedUser().then(function (user) {\n        _this.setState({\n          authState: 'signedIn',\n          authData: user,\n          stateFromStorage: true\n        });\n      }).catch(function (err) {\n        return logger.error(err);\n      });\n    } else if (this.props.stateFromStorage) {\n      this.setState({\n        stateFromStorage: true\n      });\n    }\n  };\n\n  SignOut.prototype.onHubCapsule = function (capsule) {\n    if (this._isMounted) {\n      var channel = capsule.channel,\n          payload = capsule.payload,\n          source = capsule.source;\n\n      if (channel === 'auth' && payload.event === 'signIn') {\n        this.setState({\n          authState: 'signedIn',\n          authData: payload.data\n        });\n      } else if (channel === 'auth' && payload.event === 'signOut' && !this.props.authState) {\n        this.setState({\n          authState: 'signIn'\n        });\n      }\n\n      if (channel === 'auth' && payload.event === 'signIn' && !this.props.authState) {\n        this.setState({\n          stateFromStorage: true\n        });\n      }\n    }\n  };\n\n  SignOut.prototype.signOut = function () {\n    var _this = this;\n\n    var payload = {};\n\n    try {\n      payload = JSON.parse(localStorage.getItem(Constants.AUTH_SOURCE_KEY)) || {};\n      localStorage.removeItem(Constants.AUTH_SOURCE_KEY);\n    } catch (e) {\n      logger.debug(\"Failed to parse the info from \" + Constants.AUTH_SOURCE_KEY + \" from localStorage with \" + e);\n    }\n\n    logger.debug('sign out from the source', payload);\n    var _a = this.props,\n        googleSignOut = _a.googleSignOut,\n        facebookSignOut = _a.facebookSignOut,\n        amazonSignOut = _a.amazonSignOut,\n        auth0SignOut = _a.auth0SignOut; // @ts-ignore\n\n    switch (payload.provider) {\n      case Constants.GOOGLE:\n        if (googleSignOut) googleSignOut();else logger.debug('No Google signout method provided');\n        break;\n\n      case Constants.FACEBOOK:\n        if (facebookSignOut) facebookSignOut();else logger.debug('No Facebook signout method provided');\n        break;\n\n      case Constants.AMAZON:\n        if (amazonSignOut) amazonSignOut();else logger.debug('No Amazon signout method provided');\n        break;\n\n      case Constants.AUTH0:\n        // @ts-ignore\n        if (auth0SignOut) auth0SignOut(payload.opts);else logger.debug('No Auth0 signout method provided');\n        break;\n\n      default:\n        break;\n    }\n\n    if (!Auth || typeof Auth.signOut !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    Auth.signOut().then(function () {\n      if (!_this.state.stateFromStorage) {\n        _this.changeState('signedOut');\n      }\n    }).catch(function (err) {\n      logger.debug(err);\n\n      _this.error(err);\n    });\n  };\n\n  SignOut.prototype.render = function () {\n    var hide = this.props.hide;\n\n    if (hide && hide.includes(SignOut)) {\n      return null;\n    }\n\n    var authState = this.props.authState || this.state.authState;\n    var signedIn = authState === 'signedIn';\n    var theme = this.props.theme || AmplifyTheme;\n\n    if (!signedIn) {\n      return null;\n    }\n\n    return React.createElement(NavButton, {\n      theme: theme,\n      onClick: this.signOut,\n      \"data-test\": auth.signOut.button\n    }, I18n.get('Sign Out'));\n  };\n\n  return SignOut;\n}(AuthPiece);\n\nexport default SignOut;","map":{"version":3,"sources":["../../src/Auth/SignOut.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport * as React from 'react';\nimport { I18n, ConsoleLogger as Logger, Hub } from '@aws-amplify/core';\nimport Auth from '@aws-amplify/auth';\nimport AuthPiece from './AuthPiece';\nimport { NavButton } from '../Amplify-UI/Amplify-UI-Components-React';\nimport AmplifyTheme from '../Amplify-UI/Amplify-UI-Theme';\nimport Constants from './common/constants';\nimport { auth } from '../Amplify-UI/data-test-attributes';\nvar logger = new Logger('SignOut');\nvar SignOut = /** @class */ (function (_super) {\n    __extends(SignOut, _super);\n    function SignOut(props) {\n        var _this = _super.call(this, props) || this;\n        _this.signOut = _this.signOut.bind(_this);\n        _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n        Hub.listen('auth', _this.onHubCapsule);\n        _this.state = {};\n        return _this;\n    }\n    SignOut.prototype.componentDidMount = function () {\n        this._isMounted = true;\n        this.findState();\n    };\n    SignOut.prototype.componentWillUnmount = function () {\n        this._isMounted = false;\n    };\n    SignOut.prototype.findState = function () {\n        var _this = this;\n        if (!this.props.authState && !this.props.authData) {\n            Auth.currentAuthenticatedUser()\n                .then(function (user) {\n                _this.setState({\n                    authState: 'signedIn',\n                    authData: user,\n                    stateFromStorage: true,\n                });\n            })\n                .catch(function (err) { return logger.error(err); });\n        }\n        else if (this.props.stateFromStorage) {\n            this.setState({\n                stateFromStorage: true,\n            });\n        }\n    };\n    SignOut.prototype.onHubCapsule = function (capsule) {\n        if (this._isMounted) {\n            var channel = capsule.channel, payload = capsule.payload, source = capsule.source;\n            if (channel === 'auth' && payload.event === 'signIn') {\n                this.setState({\n                    authState: 'signedIn',\n                    authData: payload.data,\n                });\n            }\n            else if (channel === 'auth' &&\n                payload.event === 'signOut' &&\n                !this.props.authState) {\n                this.setState({\n                    authState: 'signIn',\n                });\n            }\n            if (channel === 'auth' &&\n                payload.event === 'signIn' &&\n                !this.props.authState) {\n                this.setState({ stateFromStorage: true });\n            }\n        }\n    };\n    SignOut.prototype.signOut = function () {\n        var _this = this;\n        var payload = {};\n        try {\n            payload =\n                JSON.parse(localStorage.getItem(Constants.AUTH_SOURCE_KEY)) || {};\n            localStorage.removeItem(Constants.AUTH_SOURCE_KEY);\n        }\n        catch (e) {\n            logger.debug(\"Failed to parse the info from \" + Constants.AUTH_SOURCE_KEY + \" from localStorage with \" + e);\n        }\n        logger.debug('sign out from the source', payload);\n        var _a = this.props, googleSignOut = _a.googleSignOut, facebookSignOut = _a.facebookSignOut, amazonSignOut = _a.amazonSignOut, auth0SignOut = _a.auth0SignOut;\n        // @ts-ignore\n        switch (payload.provider) {\n            case Constants.GOOGLE:\n                if (googleSignOut)\n                    googleSignOut();\n                else\n                    logger.debug('No Google signout method provided');\n                break;\n            case Constants.FACEBOOK:\n                if (facebookSignOut)\n                    facebookSignOut();\n                else\n                    logger.debug('No Facebook signout method provided');\n                break;\n            case Constants.AMAZON:\n                if (amazonSignOut)\n                    amazonSignOut();\n                else\n                    logger.debug('No Amazon signout method provided');\n                break;\n            case Constants.AUTH0:\n                // @ts-ignore\n                if (auth0SignOut)\n                    auth0SignOut(payload.opts);\n                else\n                    logger.debug('No Auth0 signout method provided');\n                break;\n            default:\n                break;\n        }\n        if (!Auth || typeof Auth.signOut !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n        }\n        Auth.signOut()\n            .then(function () {\n            if (!_this.state.stateFromStorage) {\n                _this.changeState('signedOut');\n            }\n        })\n            .catch(function (err) {\n            logger.debug(err);\n            _this.error(err);\n        });\n    };\n    SignOut.prototype.render = function () {\n        var hide = this.props.hide;\n        if (hide && hide.includes(SignOut)) {\n            return null;\n        }\n        var authState = this.props.authState || this.state.authState;\n        var signedIn = authState === 'signedIn';\n        var theme = this.props.theme || AmplifyTheme;\n        if (!signedIn) {\n            return null;\n        }\n        return (React.createElement(NavButton, { theme: theme, onClick: this.signOut, \"data-test\": auth.signOut.button }, I18n.get('Sign Out')));\n    };\n    return SignOut;\n}(AuthPiece));\nexport default SignOut;\n//# sourceMappingURL=SignOut.js.map"]},"metadata":{},"sourceType":"module"}