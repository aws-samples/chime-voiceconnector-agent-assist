{"ast":null,"code":"var util = require('../core').util;\n\nvar toBuffer = util.buffer.toBuffer; // All prelude components are unsigned, 32-bit integers\n\nvar PRELUDE_MEMBER_LENGTH = 4; // The prelude consists of two components\n\nvar PRELUDE_LENGTH = PRELUDE_MEMBER_LENGTH * 2; // Checksums are always CRC32 hashes.\n\nvar CHECKSUM_LENGTH = 4; // Messages must include a full prelude, a prelude checksum, and a message checksum\n\nvar MINIMUM_MESSAGE_LENGTH = PRELUDE_LENGTH + CHECKSUM_LENGTH * 2;\n/**\n * @api private\n *\n * @param {Buffer} message\n */\n\nfunction splitMessage(message) {\n  if (!util.Buffer.isBuffer(message)) message = toBuffer(message);\n\n  if (message.length < MINIMUM_MESSAGE_LENGTH) {\n    throw new Error('Provided message too short to accommodate event stream message overhead');\n  }\n\n  if (message.length !== message.readUInt32BE(0)) {\n    throw new Error('Reported message length does not match received message length');\n  }\n\n  var expectedPreludeChecksum = message.readUInt32BE(PRELUDE_LENGTH);\n\n  if (expectedPreludeChecksum !== util.crypto.crc32(message.slice(0, PRELUDE_LENGTH))) {\n    throw new Error('The prelude checksum specified in the message (' + expectedPreludeChecksum + ') does not match the calculated CRC32 checksum.');\n  }\n\n  var expectedMessageChecksum = message.readUInt32BE(message.length - CHECKSUM_LENGTH);\n\n  if (expectedMessageChecksum !== util.crypto.crc32(message.slice(0, message.length - CHECKSUM_LENGTH))) {\n    throw new Error('The message checksum did not match the expected value of ' + expectedMessageChecksum);\n  }\n\n  var headersStart = PRELUDE_LENGTH + CHECKSUM_LENGTH;\n  var headersEnd = headersStart + message.readUInt32BE(PRELUDE_MEMBER_LENGTH);\n  return {\n    headers: message.slice(headersStart, headersEnd),\n    body: message.slice(headersEnd, message.length - CHECKSUM_LENGTH)\n  };\n}\n/**\n * @api private\n */\n\n\nmodule.exports = {\n  splitMessage: splitMessage\n};","map":{"version":3,"sources":["/home/ec2-user/chime-voiceconnector-agent-assist/node_modules/@aws-amplify/core/node_modules/aws-sdk/lib/event-stream/split-message.js"],"names":["util","require","toBuffer","buffer","PRELUDE_MEMBER_LENGTH","PRELUDE_LENGTH","CHECKSUM_LENGTH","MINIMUM_MESSAGE_LENGTH","splitMessage","message","Buffer","isBuffer","length","Error","readUInt32BE","expectedPreludeChecksum","crypto","crc32","slice","expectedMessageChecksum","headersStart","headersEnd","headers","body","module","exports"],"mappings":"AAAA,IAAIA,IAAI,GAAGC,OAAO,CAAC,SAAD,CAAP,CAAmBD,IAA9B;;AACA,IAAIE,QAAQ,GAAGF,IAAI,CAACG,MAAL,CAAYD,QAA3B,C,CAEA;;AACA,IAAIE,qBAAqB,GAAG,CAA5B,C,CACA;;AACA,IAAIC,cAAc,GAAGD,qBAAqB,GAAG,CAA7C,C,CACA;;AACA,IAAIE,eAAe,GAAG,CAAtB,C,CACA;;AACA,IAAIC,sBAAsB,GAAGF,cAAc,GAAGC,eAAe,GAAG,CAAhE;AAEA;;;;;;AAKA,SAASE,YAAT,CAAsBC,OAAtB,EAA+B;AAC3B,MAAI,CAACT,IAAI,CAACU,MAAL,CAAYC,QAAZ,CAAqBF,OAArB,CAAL,EAAoCA,OAAO,GAAGP,QAAQ,CAACO,OAAD,CAAlB;;AAEpC,MAAIA,OAAO,CAACG,MAAR,GAAiBL,sBAArB,EAA6C;AACzC,UAAM,IAAIM,KAAJ,CAAU,yEAAV,CAAN;AACH;;AAED,MAAIJ,OAAO,CAACG,MAAR,KAAmBH,OAAO,CAACK,YAAR,CAAqB,CAArB,CAAvB,EAAgD;AAC5C,UAAM,IAAID,KAAJ,CAAU,gEAAV,CAAN;AACH;;AAED,MAAIE,uBAAuB,GAAGN,OAAO,CAACK,YAAR,CAAqBT,cAArB,CAA9B;;AAEA,MACIU,uBAAuB,KAAKf,IAAI,CAACgB,MAAL,CAAYC,KAAZ,CACxBR,OAAO,CAACS,KAAR,CAAc,CAAd,EAAiBb,cAAjB,CADwB,CADhC,EAIE;AACE,UAAM,IAAIQ,KAAJ,CACF,oDACAE,uBADA,GAEA,iDAHE,CAAN;AAKH;;AAED,MAAII,uBAAuB,GAAGV,OAAO,CAACK,YAAR,CAAqBL,OAAO,CAACG,MAAR,GAAiBN,eAAtC,CAA9B;;AAEA,MACIa,uBAAuB,KAAKnB,IAAI,CAACgB,MAAL,CAAYC,KAAZ,CACxBR,OAAO,CAACS,KAAR,CAAc,CAAd,EAAiBT,OAAO,CAACG,MAAR,GAAiBN,eAAlC,CADwB,CADhC,EAIE;AACE,UAAM,IAAIO,KAAJ,CACF,8DACIM,uBAFF,CAAN;AAIH;;AAED,MAAIC,YAAY,GAAGf,cAAc,GAAGC,eAApC;AACA,MAAIe,UAAU,GAAGD,YAAY,GAAGX,OAAO,CAACK,YAAR,CAAqBV,qBAArB,CAAhC;AAEA,SAAO;AACHkB,IAAAA,OAAO,EAAEb,OAAO,CAACS,KAAR,CAAcE,YAAd,EAA4BC,UAA5B,CADN;AAEHE,IAAAA,IAAI,EAAEd,OAAO,CAACS,KAAR,CAAcG,UAAd,EAA0BZ,OAAO,CAACG,MAAR,GAAiBN,eAA3C;AAFH,GAAP;AAIH;AAED;;;;;AAGAkB,MAAM,CAACC,OAAP,GAAiB;AACbjB,EAAAA,YAAY,EAAEA;AADD,CAAjB","sourcesContent":["var util = require('../core').util;\nvar toBuffer = util.buffer.toBuffer;\n\n// All prelude components are unsigned, 32-bit integers\nvar PRELUDE_MEMBER_LENGTH = 4;\n// The prelude consists of two components\nvar PRELUDE_LENGTH = PRELUDE_MEMBER_LENGTH * 2;\n// Checksums are always CRC32 hashes.\nvar CHECKSUM_LENGTH = 4;\n// Messages must include a full prelude, a prelude checksum, and a message checksum\nvar MINIMUM_MESSAGE_LENGTH = PRELUDE_LENGTH + CHECKSUM_LENGTH * 2;\n\n/**\n * @api private\n *\n * @param {Buffer} message\n */\nfunction splitMessage(message) {\n    if (!util.Buffer.isBuffer(message)) message = toBuffer(message);\n\n    if (message.length < MINIMUM_MESSAGE_LENGTH) {\n        throw new Error('Provided message too short to accommodate event stream message overhead');\n    }\n\n    if (message.length !== message.readUInt32BE(0)) {\n        throw new Error('Reported message length does not match received message length');\n    }\n\n    var expectedPreludeChecksum = message.readUInt32BE(PRELUDE_LENGTH);\n\n    if (\n        expectedPreludeChecksum !== util.crypto.crc32(\n            message.slice(0, PRELUDE_LENGTH)\n        )\n    ) {\n        throw new Error(\n            'The prelude checksum specified in the message (' +\n            expectedPreludeChecksum +\n            ') does not match the calculated CRC32 checksum.'\n        );\n    }\n\n    var expectedMessageChecksum = message.readUInt32BE(message.length - CHECKSUM_LENGTH);\n\n    if (\n        expectedMessageChecksum !== util.crypto.crc32(\n            message.slice(0, message.length - CHECKSUM_LENGTH)\n        )\n    ) {\n        throw new Error(\n            'The message checksum did not match the expected value of ' +\n                expectedMessageChecksum\n        );\n    }\n\n    var headersStart = PRELUDE_LENGTH + CHECKSUM_LENGTH;\n    var headersEnd = headersStart + message.readUInt32BE(PRELUDE_MEMBER_LENGTH);\n\n    return {\n        headers: message.slice(headersStart, headersEnd),\n        body: message.slice(headersEnd, message.length - CHECKSUM_LENGTH),\n    };\n}\n\n/**\n * @api private\n */\nmodule.exports = {\n    splitMessage: splitMessage\n};\n"]},"metadata":{},"sourceType":"script"}