{"ast":null,"code":"import _regeneratorRuntime from\"/home/ec2-user/chime-voiceconnector-agent-assist/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ec2-user/chime-voiceconnector-agent-assist/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\nimport React from'react';import AWS from'aws-sdk';import{API,graphqlOperation}from'aws-amplify';import{withAuthenticator}from'aws-amplify-react';import{mergeAndComprehendTranscript}from'../utils/transcript';import awsExports from'../aws-exports';import'../styles/AgentAssist.css';const defaultRegion=awsExports.aws_project_region;AWS.config.update({region:defaultRegion});const readTranscript=\"\\nquery listTranscriptSegments($nextToken: String = \\\"\\\") {\\n    listTranscriptSegments(nextToken: $nextToken) {\\n        items {\\n            TransactionId\\n                StartTime\\n                Speaker\\n                EndTime\\n                Transcript\\n                LoggedOn\\n        },\\n        nextToken\\n    }\\n}\\n\";const anncTranscript=\"subscription {\\n    onAnnounceCreateTranscriptSegment {\\n        TransactionId\\n            StartTime\\n            Speaker\\n            EndTime\\n            Transcript\\n            LoggedOn\\n    }\\n}\\n\";class AgentAssist extends React.Component{constructor(props){super(props);this.state={transcript:[]};}componentDidMount(){var _this=this;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var transcript,observable,addSegmentToState,updateTranscript;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return _this.readTranscriptPaginationAndUpdate();case 2:transcript=_context.sent;_this.setState({transcript:transcript});_context.next=6;return API.graphql(graphqlOperation(anncTranscript));case 6:observable=_context.sent;addSegmentToState=segment=>{_this.setState(state=>{const updatedTranscript=state.transcript.slice();updatedTranscript.push(segment);return{transcript:updatedTranscript};});};updateTranscript=data=>{const segment=data.value.data.onAnnounceCreateTranscriptSegment;addSegmentToState(segment);return;};observable.subscribe({next:updateTranscript,complete:console.log,error:console.error});case 10:case\"end\":return _context.stop();}},_callee);}))();}readTranscriptPaginationAndUpdate(){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var transcript,firstPage,nextToken,nextPage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:transcript=[];_context2.next=3;return API.graphql(graphqlOperation(readTranscript));case 3:firstPage=_context2.sent;nextToken=firstPage.data.listTranscriptSegments.nextToken;transcript=transcript.concat(firstPage.data.listTranscriptSegments.items);case 6:if(!(nextToken!==null)){_context2.next=14;break;}_context2.next=9;return API.graphql(graphqlOperation(readTranscript,{nextToken:nextToken}));case 9:nextPage=_context2.sent;nextToken=nextPage.data.listTranscriptSegments.nextToken;transcript=transcript.concat(nextPage.data.listTranscriptSegments.items);_context2.next=6;break;case 14:return _context2.abrupt(\"return\",transcript);case 15:case\"end\":return _context2.stop();}},_callee2);}))();}shouldMergeTranscript(){return this.props.value===this.props.index;}render(){let data=[];if(this.shouldMergeTranscript()){const latestCall=this.state.transcript.reduce((acc,curr)=>acc!==null&&acc.LoggedOn>curr.LoggedOn?acc:curr,null);const currentTransactionId=latestCall===null?null:latestCall.TransactionId;data=[].concat(this.state.transcript.filter(e=>e.TransactionId===currentTransactionId&&e.EndTime!==null));data=mergeAndComprehendTranscript(data).map((item,i)=>/*#__PURE__*/React.createElement(\"tr\",{key:i},/*#__PURE__*/React.createElement(\"td\",null,item.StartTime.toFixed(3)),/*#__PURE__*/React.createElement(\"td\",null,item.Speaker&&item.Speaker==='spk_0'?'agent':'caller'),/*#__PURE__*/React.createElement(\"td\",{className:item.SentimentClass?item.SentimentClass:'s-none'},item.Sentiment?item.Sentiment:''),/*#__PURE__*/React.createElement(\"td\",null,item.Action&&item.Action==='ClientSnapshot'?/*#__PURE__*/React.createElement(\"a\",{href:\"#modal2\",className:\"action\"},\"Client Snapshot\"):''),/*#__PURE__*/React.createElement(\"td\",{className:\"transcript-note\"},item.Transcript)));}return/*#__PURE__*/React.createElement(\"div\",{className:\"AssistAgent\",hidden:this.props.value!==this.props.index},/*#__PURE__*/React.createElement(\"table\",{id:\"ttlist\",className:\"transcript\"},/*#__PURE__*/React.createElement(\"thead\",{className:\"transcript\"},/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,\"Start\"),/*#__PURE__*/React.createElement(\"th\",null,\"Speaker\"),/*#__PURE__*/React.createElement(\"th\",{style:{width:'3em'}},\"\\xB1\"),/*#__PURE__*/React.createElement(\"th\",null,\"Action\"),/*#__PURE__*/React.createElement(\"th\",{style:{width:'60%'}},\"Transcript\",/*#__PURE__*/React.createElement(\"a\",{href:\"#a\",onClick:e=>{this.setState({transcript:[]});e.preventDefault();},title:\"Clear transcript\"},\"\\u2205\")))),/*#__PURE__*/React.createElement(\"tbody\",null,data)),/*#__PURE__*/React.createElement(\"div\",{id:\"modal1\",className:\"overlay\"},/*#__PURE__*/React.createElement(\"a\",{className:\"cancel\",href:\"#a\",title:\"Close modal\"},' '),/*#__PURE__*/React.createElement(\"div\",{className:\"modal\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Connection Doctor\"),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"table\",null,/*#__PURE__*/React.createElement(\"tbody\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"PNR: \"),/*#__PURE__*/React.createElement(\"td\",null,\"CJK1Z3\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"PAX: \"),/*#__PURE__*/React.createElement(\"td\",null,\"Johnson/Jonas\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Itinerary: \"),/*#__PURE__*/React.createElement(\"td\",null,\"LGA/MIA NA 1211 1219/1531 (now 1600/1912)\",/*#__PURE__*/React.createElement(\"br\",null),\"CONN 134 min (now *MISSED*)\",/*#__PURE__*/React.createElement(\"br\",null),\"MIA/SJU NA 2561 1745/2026\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Remediation\"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('Internal')},\"Internal (0)\"),/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('Codeshare')},\"Codeshare (2)\"),/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('Other')},\"Other (10+)\")))))))),/*#__PURE__*/React.createElement(\"div\",{id:\"modal2\",className:\"overlay\"},/*#__PURE__*/React.createElement(\"a\",{className:\"cancel\",href:\"#a\",title:\"Close modal\"},' '),/*#__PURE__*/React.createElement(\"div\",{className:\"modal\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Client Snapshot\"),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"table\",null,/*#__PURE__*/React.createElement(\"tbody\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Account: \"),/*#__PURE__*/React.createElement(\"td\",null,\"PC1234\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"User: \"),/*#__PURE__*/React.createElement(\"td\",null,\"joe@joey.com\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Software: \"),/*#__PURE__*/React.createElement(\"td\",null,\"PowerChart 1.35 (upgraded 12-Feb-2020 3:02 PM UTC)\")),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Remediation\"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('ReleaseNotes')},\"Release notes\"),/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('Manager')},\"Mgr. Escalation\"),/*#__PURE__*/React.createElement(\"span\",{className:\"opt\",onClick:()=>console.log('Credits')},\"Credits\")))))))));}}export default withAuthenticator(AgentAssist,false);","map":{"version":3,"sources":["/home/ec2-user/chime-voiceconnector-agent-assist/src/agentAssist/AgentAssist.js"],"names":["React","AWS","API","graphqlOperation","withAuthenticator","mergeAndComprehendTranscript","awsExports","defaultRegion","aws_project_region","config","update","region","readTranscript","anncTranscript","AgentAssist","Component","constructor","props","state","transcript","componentDidMount","readTranscriptPaginationAndUpdate","setState","graphql","observable","addSegmentToState","segment","updatedTranscript","slice","push","updateTranscript","data","value","onAnnounceCreateTranscriptSegment","subscribe","next","complete","console","log","error","firstPage","nextToken","listTranscriptSegments","concat","items","nextPage","shouldMergeTranscript","index","render","latestCall","reduce","acc","curr","LoggedOn","currentTransactionId","TransactionId","filter","e","EndTime","map","item","i","StartTime","toFixed","Speaker","SentimentClass","Sentiment","Action","Transcript","width","preventDefault"],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: MIT-0\n\nimport React from 'react';\nimport AWS from 'aws-sdk';\nimport { API, graphqlOperation } from 'aws-amplify';\nimport { withAuthenticator } from 'aws-amplify-react';\n\nimport { mergeAndComprehendTranscript } from '../utils/transcript';\nimport awsExports from '../aws-exports';\nimport '../styles/AgentAssist.css';\n\nconst defaultRegion = awsExports.aws_project_region;\nAWS.config.update({\n  region: defaultRegion,\n});\n\nconst readTranscript = `\nquery listTranscriptSegments($nextToken: String = \"\") {\n    listTranscriptSegments(nextToken: $nextToken) {\n        items {\n            TransactionId\n                StartTime\n                Speaker\n                EndTime\n                Transcript\n                LoggedOn\n        },\n        nextToken\n    }\n}\n`;\n\nconst anncTranscript = `subscription {\n    onAnnounceCreateTranscriptSegment {\n        TransactionId\n            StartTime\n            Speaker\n            EndTime\n            Transcript\n            LoggedOn\n    }\n}\n`;\n\nclass AgentAssist extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      transcript: [],\n    };\n  }\n\n  async componentDidMount() {\n    const transcript = await this.readTranscriptPaginationAndUpdate();\n    this.setState({ transcript: transcript });\n\n    const observable = await API.graphql(graphqlOperation(anncTranscript));\n    const addSegmentToState = segment => {\n      this.setState(state => {\n        const updatedTranscript = state.transcript.slice();\n        updatedTranscript.push(segment);\n        return {\n          transcript: updatedTranscript,\n        };\n      });\n    };\n\n    const updateTranscript = data => {\n      const segment = data.value.data.onAnnounceCreateTranscriptSegment;\n      addSegmentToState(segment);\n      return;\n    };\n\n    observable.subscribe({\n      next: updateTranscript,\n      complete: console.log,\n      error: console.error,\n    });\n  }\n\n  async readTranscriptPaginationAndUpdate() {\n    let transcript = [];\n    const firstPage = await API.graphql(graphqlOperation(readTranscript));\n    let nextToken = firstPage.data.listTranscriptSegments.nextToken;\n\n    transcript = transcript.concat(firstPage.data.listTranscriptSegments.items);\n\n    while (nextToken !== null) {\n      const nextPage = await API.graphql(\n        graphqlOperation(readTranscript, { nextToken: nextToken })\n      );\n      nextToken = nextPage.data.listTranscriptSegments.nextToken;\n      transcript = transcript.concat(nextPage.data.listTranscriptSegments.items);\n    }\n\n    return transcript;\n  }\n\n  shouldMergeTranscript() {\n    return this.props.value === this.props.index;\n  }\n\n  render() {\n    let data = [];\n    if (this.shouldMergeTranscript()) {\n      const latestCall = this.state.transcript.reduce(\n        (acc, curr) => (acc !== null && acc.LoggedOn > curr.LoggedOn ? acc : curr),\n        null\n      );\n      const currentTransactionId = latestCall === null ? null : latestCall.TransactionId;\n      data = [].concat(\n        this.state.transcript.filter(\n          e => e.TransactionId === currentTransactionId && e.EndTime !== null\n        )\n      );\n      data = mergeAndComprehendTranscript(data).map((item, i) => (\n        <tr key={i}>\n          <td>{item.StartTime.toFixed(3)}</td>\n          <td>{item.Speaker && item.Speaker === 'spk_0' ? 'agent' : 'caller'}</td>\n          <td className={item.SentimentClass ? item.SentimentClass : 's-none'}>\n            {item.Sentiment ? item.Sentiment : ''}\n          </td>\n          <td>\n            {item.Action && item.Action === 'ClientSnapshot' ? (\n              <a href=\"#modal2\" className=\"action\">\n                Client Snapshot\n              </a>\n            ) : (\n              ''\n            )}\n          </td>\n          <td className=\"transcript-note\">{item.Transcript}</td>\n        </tr>\n      ));\n    }\n    return (\n      <div className=\"AssistAgent\" hidden={this.props.value !== this.props.index}>\n        <table id=\"ttlist\" className=\"transcript\">\n          <thead className=\"transcript\">\n            <tr>\n              <th>Start</th>\n              <th>Speaker</th>\n              <th style={{ width: '3em' }}>&plusmn;</th>\n              <th>Action</th>\n              <th style={{ width: '60%' }}>\n                Transcript\n                <a\n                  href=\"#a\"\n                  onClick={e => {\n                    this.setState({ transcript: [] });\n                    e.preventDefault();\n                  }}\n                  title=\"Clear transcript\"\n                >\n                  &empty;\n                </a>\n              </th>\n            </tr>\n          </thead>\n          <tbody>{data}</tbody>\n        </table>\n\n        <div id=\"modal1\" className=\"overlay\">\n          <a className=\"cancel\" href=\"#a\" title=\"Close modal\">\n            {' '}\n          </a>\n          <div className=\"modal\">\n            <h1>Connection Doctor</h1>\n            <div className=\"content\">\n              <table>\n                <tbody>\n                  <tr>\n                    <td>PNR: </td>\n                    <td>CJK1Z3</td>\n                  </tr>\n                  <tr>\n                    <td>PAX: </td>\n                    <td>Johnson/Jonas</td>\n                  </tr>\n                  <tr>\n                    <td>Itinerary: </td>\n                    <td>\n                      LGA/MIA NA 1211 1219/1531 (now 1600/1912)\n                      <br />\n                      CONN 134 min (now *MISSED*)\n                      <br />\n                      MIA/SJU NA 2561 1745/2026\n                    </td>\n                  </tr>\n                  <tr>\n                    <td>Remediation</td>\n                    <td>\n                      <span className=\"opt\" onClick={() => console.log('Internal')}>\n                        Internal (0)\n                      </span>\n                      <span className=\"opt\" onClick={() => console.log('Codeshare')}>\n                        Codeshare (2)\n                      </span>\n                      <span className=\"opt\" onClick={() => console.log('Other')}>\n                        Other (10+)\n                      </span>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        <div id=\"modal2\" className=\"overlay\">\n          <a className=\"cancel\" href=\"#a\" title=\"Close modal\">\n            {' '}\n          </a>\n          <div className=\"modal\">\n            <h1>Client Snapshot</h1>\n            <div className=\"content\">\n              <table>\n                <tbody>\n                  <tr>\n                    <td>Account: </td>\n                    <td>PC1234</td>\n                  </tr>\n                  <tr>\n                    <td>User: </td>\n                    <td>joe@joey.com</td>\n                  </tr>\n                  <tr>\n                    <td>Software: </td>\n                    <td>PowerChart 1.35 (upgraded 12-Feb-2020 3:02 PM UTC)</td>\n                  </tr>\n                  <tr>\n                    <td>Remediation</td>\n                    <td>\n                      <span className=\"opt\" onClick={() => console.log('ReleaseNotes')}>\n                        Release notes\n                      </span>\n                      <span className=\"opt\" onClick={() => console.log('Manager')}>\n                        Mgr. Escalation\n                      </span>\n                      <span className=\"opt\" onClick={() => console.log('Credits')}>\n                        Credits\n                      </span>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withAuthenticator(AgentAssist, false);\n"]},"metadata":{},"sourceType":"module"}